<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Opening Reproducible Research System Architecture">
  <meta name="author" content="o2r project">
  <link rel="canonical" href="https://o2r.info/architecture/">
  <link rel="shortcut icon" href="img/favicon.ico">
  <title>o2r Architecture</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="css/theme.css" />
  <link rel="stylesheet" href="css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  <link href="arc42.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Architecture";
    var mkdocs_page_input_path = "index.md";
    var mkdocs_page_url = "/architecture/";
  </script>
  
  <script src="js/jquery-2.1.1.min.js" defer></script>
  <script src="js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="." class="icon icon-home"> o2r Architecture</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href=".">Architecture</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#1-introduction-and-goals">1. Introduction and Goals</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#preamble">Preamble</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#11-requirements-overview">1.1 Requirements Overview</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#12-quality-goals">1.2 Quality Goals</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#13-stakeholders">1.3 Stakeholders</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#2-architecture-constraints">2. Architecture constraints</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#21-technical-constraints">2.1 Technical constraints</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#22-organizational-constraints">2.2 Organizational constraints</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#23-conventions">2.3 Conventions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#3-system-scope-and-context">3. System scope and context</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#31-business-context">3.1 Business context</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#32-technical-context">3.2 Technical context</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#4-solution-strategy">4. Solution strategy</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#web-api">Web API</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#microservices">Microservices</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#storage-and-intra-service-communication">Storage and intra-service communication</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#demonstration-user-data-authentication">Demonstration, user data &amp; authentication</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#tools">Tools</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#5-building-block-view">5. Building block view</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#51-refinement-level-1">5.1 Refinement Level 1</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#511-blackbox-publication-platforms">5.1.1 Blackbox Publication Platforms</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#512-blackbox-id-provider">5.1.2 Blackbox ID Provider</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#513-blackbox-execution-infrastructure">5.1.3 Blackbox Execution Infrastructure</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#514-blackbox-data-repositories">5.1.4 Blackbox Data Repositories</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#515-blackbox-registries">5.1.5 Blackbox Registries</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#516-blackbox-software-repositories">5.1.6 Blackbox Software Repositories</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#52-refinement-level-2">5.2 Refinement Level 2</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#521-whitebox-publication-platforms">5.2.1 Whitebox Publication Platforms</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#522-whitebox-id-provider">5.2.2 Whitebox ID Provider</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#523-whitebox-execution-infrastructure">5.2.3 Whitebox Execution Infrastructure</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#524-whitebox-data-repositories">5.2.4 Whitebox Data Repositories</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#525-whitebox-registries">5.2.5 Whitebox Registries</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#526-whitebox-software-repositories">5.2.6 Whitebox Software Repositories</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#527-whitebox-reproducibility-service">5.2.7 Whitebox Reproducibility Service</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#53-refinement-level-3">5.3 Refinement Level 3</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#531-whitebox-microservices">5.3.1 Whitebox microservices</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#532-whitebox-database">5.3.2 Whitebox database</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#533-whitebox-tools">5.3.3 Whitebox tools</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#meta">Meta</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#containerit">Containerit</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#534-whitebox-ephemeral-file-storage">5.3.4 Whitebox ephemeral file storage</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#6-runtime-view">6. Runtime view</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#61-erc-creation">6.1 ERC Creation</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#62-erc-inspection">6.2 ERC Inspection</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#7-deployment-view">7. Deployment View</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#71-test-server-httpso2runi-muensterde">7.1 Test server https://o2r.uni-muenster.de</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#72-production-sketch">7.2 Production (sketch)</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#credits">Credits</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#license">License</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#about-arc42">About arc42</a>
    </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="user-scenarios/">User scenarios</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="glossary/">Glossary</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="metadata/">Metadata</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="zenodo/">Zenodo integration</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href=".">o2r Architecture</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".">Docs</a> &raquo;</li>
    
      
    
    <li>Architecture</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/o2r-project/architecture/tree/master/docs/index.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="opening-reproducible-research-system-architecture">Opening Reproducible Research System Architecture<a class="headerlink" href="#opening-reproducible-research-system-architecture" title="Permanent link">&para;</a></h1>
<h2 id="1-introduction-and-goals">1. Introduction and Goals<a class="headerlink" href="#1-introduction-and-goals" title="Permanent link">&para;</a></h2>
<h3 id="preamble">Preamble<a class="headerlink" href="#preamble" title="Permanent link">&para;</a></h3>
<p>The packaging of research workflows is based on the concept of the <strong>Executable Research Compendium</strong> (ERC, see <a href="https://o2r.info/erc-spec">specification</a> and <a href="https://doi.org/10.1045/january2017-nuest">article</a>).
The reproducibility service is defined by a <a href="https://o2r.info/api/">web <strong>API</strong> specification</a> and demonstrated in a <a href="https://github.com/o2r-project/reference-implementation"><strong>reference implementation</strong></a>.
Both are published under permissive open licenses, as is this document.</p>
<p>The normative specification is given in the <a href="https://en.wikipedia.org/wiki/Markdown">Markdown</a> formatted files in the <a href="https://github.com/o2r-project/architecture/">project repository</a>, which form the basis for readable PDF and HTML versions of the architecture.
A HTML and PDF version of this document are available at <a href="https://o2r.info/architecture/">https://o2r.info/architecture/</a> and <a href="https://o2r.info/architecture/o2r-architecture.pdf">https://o2r.info/architecture/o2r-architecture.pdf</a> respectively.</p>
<h3 id="11-requirements-overview">1.1 Requirements Overview<a class="headerlink" href="#11-requirements-overview" title="Permanent link">&para;</a></h3>
<p>This architecture describes the relationship of a <strong>reproducibility service</strong> with other services from the context of scientific collaboration, publishing, and preservation.
Together these services can be combined into a new system for transparent and reproducible scholarly publications.</p>
<p>The reproducibility service must provide a reliable way to create and inspect packages of computational research to support reproducible publications.
<em>Creation</em> comprises uploading of a researcher's workspace with code, data, and documentation for building a reproducible runtime environment.
This runtime environment forms the basis for <em>inspection</em>, i.e. discovering, examining details, and manipulating workflows on an online platform.</p>
<h3 id="12-quality-goals">1.2 Quality Goals<a class="headerlink" href="#12-quality-goals" title="Permanent link">&para;</a></h3>
<dl>
<dt>Transparency</dt>
<dd>The system must be transparent to allow a scrutiny demanded by a rigorous scientific process.
All software components must be Free and Open Source Software (<a href="https://en.wikipedia.org/wiki/Free_and_open-source_software">FOSS</a>).
All text and specification must be available under a permissive <a href="https://en.wikipedia.org/wiki/Public_copyright_license">public copyright license</a>.</dd>
<dt>Separation of concern</dt>
<dd>The system must integrate with existing services and focus on the core functionality: creating interactive reproducible runtime environments for scientific workflows.
It must not replicate existing functionality such as storage or persistent identification.</dd>
<dt>Flexibility &amp; modularity</dt>
<dd>In regard to the research project setting, the system components must be well separated, so functions can be developed independently, e.g. using different programming languages.
This allows different developers to contribute efficiently.
It must be possible to provide various computational configurations required by specific ERC which are outside of the included runtime.</dd>
</dl>
<h3 id="13-stakeholders">1.3 Stakeholders<a class="headerlink" href="#13-stakeholders" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Role/Name</th>
<th>Goal/point of contact</th>
<th>Required interaction</th>
</tr>
</thead>
<tbody>
<tr>
<td>Author (scientist)</td>
<td>publish ERC as part of a scientific publication process</td>
<td>-</td>
</tr>
<tr>
<td>Reviewer (scientist)</td>
<td>examine ERC during a review process</td>
<td>-</td>
</tr>
<tr>
<td>Co-author (scientist)</td>
<td>contribute to ERC during research (e.g. cloud based)</td>
<td>-</td>
</tr>
<tr>
<td>Reader (scientist)</td>
<td>view and interact with ERC on a journal website</td>
<td>-</td>
</tr>
<tr>
<td>Publisher</td>
<td>increase quality of publications in journals with ERC</td>
<td>-</td>
</tr>
<tr>
<td>Curator/preservationist</td>
<td>ensure research is complete and archivable using ERC</td>
<td>-</td>
</tr>
<tr>
<td>Operator</td>
<td>provide infrastructure to researchers at my university to collaborate and conduct high-quality research using ERC</td>
<td>-</td>
</tr>
<tr>
<td>Developer</td>
<td>use and extend the tools around ERC</td>
<td>-</td>
</tr>
</tbody>
</table>
<p>Some of the stakeholders are accompanied by <a href="user-scenarios/">user scenarios</a> in prose.</p>
<h2 id="2-architecture-constraints">2. Architecture constraints<a class="headerlink" href="#2-architecture-constraints" title="Permanent link">&para;</a></h2>
<p>This section shows constraints on this project given by involved parties or conscious decisions made to ensure the longevity and transparency of the architecture and its implementations.
If applicable, a motivation for constraints is given. (based on <a href="https://biking.michael-simons.eu/docs/index.html#section-architecture-constraints">biking2</a>)</p>
<h3 id="21-technical-constraints">2.1 Technical constraints<a class="headerlink" href="#21-technical-constraints" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>&nbsp;</th>
<th>Constraint</th>
<th>Background and/or motivation</th>
</tr>
</thead>
<tbody>
<tr>
<td>TECH.1</td>
<td>Only open licenses</td>
<td>All third party software or used data must be available under a suitable code license, i.e. either <a href="https://opensource.org/licenses">OSI-approved</a> or <a href="https://opendatacommons.org/licenses">ODC license</a>.</td>
</tr>
<tr>
<td>TECH.2</td>
<td>OS independent development and deployment</td>
<td>Server applications must run in well defined <a href="https://docker.com">Docker</a> containers to allow installation on any host system and to not limit developers to a specific language or environment.</td>
</tr>
<tr>
<td>TECH.3</td>
<td>Do not store secure information</td>
<td>The team members experience and available resources do not allow for handling information with security concerns, so no critical data, such as user passwords but also data with privacy concerns, must be stored in the system.</td>
</tr>
<tr>
<td>TECH.4</td>
<td>Configurations for ERC runtimes</td>
<td>ERCs include the runtime environment in form of a binary archive. The architecture must support executing this runtime environment and must be able to provide different configurations outside it, for example <a href="/glossary#computer-architecture">computer architectures</a> or operating system <a href="/glossary#kernel">kernels</a>. The minimum requirements for the containerisation solution regarding architecture and kernel apply.</td>
</tr>
</tbody>
</table>
<h3 id="22-organizational-constraints">2.2 Organizational constraints<a class="headerlink" href="#22-organizational-constraints" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>&nbsp;</th>
<th>Constraint</th>
<th>Background and/or motivation</th>
</tr>
</thead>
<tbody>
<tr>
<td>ORG.1</td>
<td>Team and schedule</td>
<td><a href="https://o2r.info/about">https://o2r.info/about</a></td>
</tr>
<tr>
<td>ORG.2</td>
<td>Do not interfere with existing well-established peer-review process</td>
<td>This software is <em>not</em> going to change how scientific publishing works, nor should it. While intentioned to support public peer-reviews, open science etc., the software should be agnostic of these aspects.</td>
</tr>
<tr>
<td>ORG.3</td>
<td>Only open licenses</td>
<td>All created software must be available under an <a href="https://opensource.org/licenses">OSI-approved</a> license, documentation and specification under a <a href="https://creativecommons.org/licenses">CC license</a>.</td>
</tr>
<tr>
<td>ORG.4</td>
<td>Version control/management</td>
<td>Code must be versioned using <code>git</code> and published on <a href="https://github.com/o2r-project">GitHub</a>.</td>
</tr>
<tr>
<td>ORG.5</td>
<td>Acknowledge transfer from group domain to persistent domain</td>
<td>The ERC bundles artifacts coming from a private or group domain for a transfer to a public and persistent domain (cf. <a href="http://www.forschungsdaten.org/index.php/Curation_Domain_Model">Curation Domain Model</a> (in German)), which imposes requirements on the incorporated metadata.</td>
</tr>
</tbody>
</table>
<h3 id="23-conventions">2.3 Conventions<a class="headerlink" href="#23-conventions" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>&nbsp;</th>
<th>Constraint</th>
<th>Background and/or motivation</th>
</tr>
</thead>
<tbody>
<tr>
<td>CONV.1</td>
<td>Provide formal architecture documentation</td>
<td>Based on <a href="http://arc42.org/">arc42</a> (template version 7.0).</td>
</tr>
<tr>
<td>CONV.2</td>
<td>Follow coding conventions</td>
<td>Typical project layout and coding conventions of the respective used language should be followed as far as possible. However, we explicitly accept the research project context and do <em>not</em> provide full tests suites or documentation beyond what is needed by project team members.</td>
</tr>
<tr>
<td>CONV.3</td>
<td>Documentation language is British English</td>
<td>International research project must be understandable by anyone interested; consistency increases readability.</td>
</tr>
<tr>
<td>CONV.4</td>
<td>Use subjectivisation for server component names</td>
<td>Server-side components are named using personalized verbs or (ideally) professions: <em>muncher</em>, <em>loader</em>, <em>transporter</em>. All git repositories for software use an <code>o2r-</code> prefix, in case of server-side components e.g. <code>o2r-shipper</code>.</td>
</tr>
<tr>
<td>CONV.5</td>
<td>Configuration using environment variables</td>
<td>Server-side components must be configurable using all caps environment variables prefixed with the component name, e.g. <code>SHIPPER_THE_SETTING</code>, for required settings. Other settings should be put in a settings file suitable for the used language, e.g. <code>config.js</code> or <code>config.yml</code>.</td>
</tr>
</tbody>
</table>
<h2 id="3-system-scope-and-context">3. System scope and context<a class="headerlink" href="#3-system-scope-and-context" title="Permanent link">&para;</a></h2>
<h3 id="31-business-context">3.1 Business context<a class="headerlink" href="#31-business-context" title="Permanent link">&para;</a></h3>
<p><a href="img/3.1-business-context.png"><img alt="business context" src="img/3.1-business-context.png" /></a></p>
<table>
<thead>
<tr>
<th>Communication partner</th>
<th>Exchanged data</th>
<th>Technology/protocol</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Reproducibility service</strong>, e.g. <a href="https://o2r.info/results">o2r reference implementation</a></td>
<td>publication platforms utilize creation and examination services for ERC; reproducibility service uses different <em>supporting services</em> to retrieve software artifacts, store runtime environment images, execute workflows, and save complete ERC</td>
<td><code>HTTP</code> APIs</td>
</tr>
<tr>
<td><strong>Publishing platform</strong>, e.g. online journal website or review system</td>
<td>users access ERC status and metadata via search results and paper landing pages; review process integrates ERC details and supports manipulation;</td>
<td>system's API using <code>HTTP</code> with <code>JSON</code> payload</td>
</tr>
<tr>
<td><strong>Collaboration platform</strong></td>
<td>provide means to collaboratively work on data, code, or text; such platforms support both public and private (shared) digital workspaces</td>
<td><code>HTTP</code></td>
</tr>
<tr>
<td><strong>ID provider</strong></td>
<td>retrieve unique user IDs, user metadata, and authentication tokens; user must log in with the provider</td>
<td><code>HTTP</code></td>
</tr>
<tr>
<td><strong>Execution infrastructure</strong></td>
<td>ERC can be executed using a shared/distributed infrastructure</td>
<td><code>HTTP</code></td>
</tr>
<tr>
<td><strong>Data repository</strong></td>
<td>the reproducibility service fetches (a) content for ERC creation, or (b) complete ERC, from different sources; it stores created ERC persistently at suitable repositories, which in turn may connect to long-term archives and preservation systems</td>
<td><code>HTTP</code>, <code>FTP</code>, <code>WebDAV</code>, <code>git</code></td>
</tr>
<tr>
<td><strong>Registry (metadata)</strong></td>
<td>the reproducibility service can deliver metadata on published ERC to registries/catalogues/search portals directly and mediately via data repositories; the service can also retrieve/harvest contextual metadata during ERC creation to reduce required user inputs; users discover ERC via registries</td>
<td>(proprietary) <code>HTTP</code> APIs, persistent identifiers (<code>DOI</code>), <code>OAI-PMH</code></td>
</tr>
<tr>
<td><strong>Software repository</strong></td>
<td>software repository provide software artifacts during ERC creation and store executable runtime environments</td>
<td><code>HTTP</code> APIs</td>
</tr>
<tr>
<td><strong>Archives and digital preservation systems</strong></td>
<td>saving ERCs in preservation systems includes extended data and metadata management (cf. private/group domain vs. persistent domain in the <a href="http://www.forschungsdaten.org/index.php/Curation_Domain_Model">Curation Domain Model</a> (in German)), because a different kind of access and re-use is of concern for these systems; these concerns are relevant in so far as the intermediary <em>data repositories</em> must be supported, but further aspects, e.g. long-term access rights, are only mediately relevant for the reproducibility service</td>
<td>metadata in <code>JSON</code> and <code>XML</code> provided as part of <code>HTTP</code> requests or as files within payloads</td>
</tr>
</tbody>
</table>
<h3 id="32-technical-context">3.2 Technical context<a class="headerlink" href="#32-technical-context" title="Permanent link">&para;</a></h3>
<p>All components use <code>HTTP(S)</code> over cable networks connections for communication (metadata documents, ERC, Linux containers, etc.).</p>
<h2 id="4-solution-strategy">4. Solution strategy<a class="headerlink" href="#4-solution-strategy" title="Permanent link">&para;</a></h2>
<p>This section provides a short overview of architecture decisions and for some the reasoning behind them.</p>
<h3 id="web-api">Web API<a class="headerlink" href="#web-api" title="Permanent link">&para;</a></h3>
<p>The developed solution is set in an existing system of services, and first and foremost must integrate well with these systems, focussing on the specific missing features of building and running ERCs.
These features are provided via a <em>well-defined RESTful API</em>.</p>
<h3 id="microservices">Microservices<a class="headerlink" href="#microservices" title="Permanent link">&para;</a></h3>
<p>To allow a dynamic development and support the large variety of skills, all server-side features are developed in independent <em><a href="https://en.wikipedia.org/wiki/Microservices">microservices</a></em>.
These microservices handle only specific functional parts of the API and allow independent development and deployment cycles.
Core components are developed using server-side JavaScript based on <a href="https://nodejs.org/">Node.js</a> with <a href="https://expressjs.com/">Express</a> while other components are implemented in Python.</p>
<p>We accept this diversification <em>increases complexity</em> of both development and testing environments and the deployment of said services.</p>
<p>Required documentation is minimal.
The typical structure should follow common practices of the respective language and tools.</p>
<h3 id="storage-and-intra-service-communication">Storage and intra-service communication<a class="headerlink" href="#storage-and-intra-service-communication" title="Permanent link">&para;</a></h3>
<p>In accordance with the system scope, there is no reliable storage solution implemented.
The microservices simply share a common pointer to a local file system path.
Storage of ERC is only implemented to make the solution independent during development and for the needs of core functionality (temporal storage), but it is not a feature the solution will eventually provide.</p>
<p>The unifying component of the architecture is the <em>database</em>.
It is known to all microservices.</p>
<p>Some microservices communicate via an eventing mechanism for real-time updates, such as the search database and the component providing live updates to the user via WebSockets.
The eventing is based on the operation log of the database (which is normally used to synchronise database nodes).
This is a clear <em>misuse of an internal feature</em>, but a lot simpler than maintaining a full-blown eventing solution.</p>
<h3 id="demonstration-user-data-authentication">Demonstration, user data &amp; authentication<a class="headerlink" href="#demonstration-user-data-authentication" title="Permanent link">&para;</a></h3>
<p>To be able to demonstrate the system, a <em>browser-based client application</em> is developed.
It uses the RESTful API to control the system.
<em>OAuth 2.0</em> is used for authentication and minimal information, which is already public, is stored for each user.
This information is shared between all services which require authentication via the database.</p>
<p><em>The client application manages the control flow</em> of all user interactions.</p>
<h3 id="tools">Tools<a class="headerlink" href="#tools" title="Permanent link">&para;</a></h3>
<p>If standalone tools are developed, they provide a command-line interface (CLI).
The CLI allows integration into microservices when needed and to package tools including their dependencies as containers and distributing them using a container registry.
These <em>2nd level containers</em> are started by the microservices and can run either next to the microservices or in an independent container cluster, providing scalability.
It must only be ensured they are correctly configured in each microservice.
The only required documentation is the installation into a container and usage of the CLI.</p>
<h2 id="5-building-block-view">5. Building block view<a class="headerlink" href="#5-building-block-view" title="Permanent link">&para;</a></h2>
<h3 id="51-refinement-level-1">5.1 Refinement Level 1<a class="headerlink" href="#51-refinement-level-1" title="Permanent link">&para;</a></h3>
<h4 id="511-blackbox-publication-platforms">5.1.1 Blackbox Publication Platforms<a class="headerlink" href="#511-blackbox-publication-platforms" title="Permanent link">&para;</a></h4>
<p>Publications platforms are the online interaction points of users with scientific works.
Users create publications, e.g. submitting to a scientific journal, publishing on a pre-print server, publishing on a self-hosted website, or collaborating in online repositories.
Users examine publications, e.g. browsing, searching, reading, downloading, or reviewing.</p>
<h4 id="512-blackbox-id-provider">5.1.2 Blackbox ID Provider<a class="headerlink" href="#512-blackbox-id-provider" title="Permanent link">&para;</a></h4>
<p>Identification information of distributed systems is crucial, and for security reasons as well as for limiting manual reproduction of metadata, a central service can provide all of</p>
<ul>
<li>unique <em>identification of users</em> and <em>metadata on users</em>,</li>
<li><em>authentication</em> of users, and</li>
<li>metadata on a user's <em>works</em>, e.g. publications or ERC.</li>
</ul>
<p>Persistent identifiers for artifacts in the reproducibility service itself are <em>not required</em>, as these are provided by data storage and registries.
However, services such as <a href="http://www.pidconsortium.eu/">ePIC</a> could allow to retrieve persistent IDs.</p>
<h4 id="513-blackbox-execution-infrastructure">5.1.3 Blackbox Execution Infrastructure<a class="headerlink" href="#513-blackbox-execution-infrastructure" title="Permanent link">&para;</a></h4>
<p>The execution infrastructure provides CPU time and temporary result storage space for execution of ERC, both "as is" and with manipulation, i.e. changed parameters.
It also provides different <a href="/glossary#architecture">architectures</a> and <a href="/glossary#kernel">operating system kernel</a> configurations which are outside of the scope of ERC's runtime environments based on containers.</p>
<h4 id="514-blackbox-data-repositories">5.1.4 Blackbox Data Repositories<a class="headerlink" href="#514-blackbox-data-repositories" title="Permanent link">&para;</a></h4>
<p>Data repositories are all services storing data but not software.
More specifically, they may store software "as data", but not with software-specific features such as code versioning or installation binaries for different computer architectures.
Data repositories may be self-hosted or public/free, domain-specific or generic.
They typically provide persistent identifiers or handles, e.g. a <a href="https://www.doi.org/">DOI</a> or <a href="https://en.wikipedia.org/wiki/Uniform_Resource_Name">URN</a>.
They are used both for loading created ERC and for storing the ERC created by the reproducibility service.</p>
<h4 id="515-blackbox-registries">5.1.5 Blackbox Registries<a class="headerlink" href="#515-blackbox-registries" title="Permanent link">&para;</a></h4>
<p>Registries are metadata indexes or catalogues.</p>
<p>They are recipients of metadata exports by the reproducibility service to share information about ERC, e.g. add a new ERC to an author's profile.
This requires the reproducibility services to translate the internal metadata model into the recipients data model and encoding. </p>
<p>They are sources of metadata during ERC creation when the information in the fetched content is used to query registries for additional information which can be offered to the user.</p>
<h4 id="516-blackbox-software-repositories">5.1.6 Blackbox Software Repositories<a class="headerlink" href="#516-blackbox-software-repositories" title="Permanent link">&para;</a></h4>
<p>Software repositories are a source and a sink for software at different abstraction levels.
They are a source for software dependencies, such as system packages for installing a library.
They are a sink for executable images, which comprise a number of software artifacts and their dependencies, for a specific ERC instance.</p>
<h3 id="52-refinement-level-2">5.2 Refinement Level 2<a class="headerlink" href="#52-refinement-level-2" title="Permanent link">&para;</a></h3>
<h4 id="521-whitebox-publication-platforms">5.2.1 Whitebox Publication Platforms<a class="headerlink" href="#521-whitebox-publication-platforms" title="Permanent link">&para;</a></h4>
<p>Publication platforms can be roughly divided into two groups.
They can be either specific journals hosted independently, such as <a href="http://www.jstatsoft.org/">JStatSoft</a> or <a href="http://joss.theoj.org/">JOSS</a>, or a larger platform provided by a publisher to multiple journals, such as <a href="http://sciencedirect.com/">ScienceDirect</a>, <a href="http://www.mdpi.com/">MDPI</a>, <a href="https://link.springer.com/">SpringerLink</a>, or <a href="https://plos.org/">PLOS</a>.
To some extend, pre-print servers, for example <a href="https://osf.io/">OSF</a> or <a href="https://arxiv.org/">arXiv.org</a>, can also fall into the latter category.</p>
<p>Integration with the reproducibility service can happen via plug-ins to generic software, e.g. <a href="https://pkp.sfu.ca/ojs/">OJS</a>, or by bespoke extensions.
Integrations are based on the service's public API.</p>
<h4 id="522-whitebox-id-provider">5.2.2 Whitebox ID Provider<a class="headerlink" href="#522-whitebox-id-provider" title="Permanent link">&para;</a></h4>
<p>The reproducibility service uses <a href="http://orcid.org/">ORCID</a> to authenticate users and retrieve user metadata.
The reproducibility service does not use the ORCID authorisation to edit ORCID user data or retrieve non-public data from ORCID, thus this process is <a href="https://security.stackexchange.com/questions/44611/difference-between-oauth-openid-and-openid-connect-in-very-simple-term">pseudo-authentication using OAuth</a>.
Internally, the user's public <code>ORCID</code> is the main identifier.
User have different levels, which allow different actions, such as "registered user" or "administrator".
These levels are stored in the reproducibility service.</p>
<h4 id="523-whitebox-execution-infrastructure">5.2.3 Whitebox Execution Infrastructure<a class="headerlink" href="#523-whitebox-execution-infrastructure" title="Permanent link">&para;</a></h4>
<p>Such an infrastructure could be either self-hosted, e.g. <a href="https://www.docker.com/products/docker-swarm">Docker Swarm</a>-based, use a cloud service provider, such as <a href="https://aws.amazon.com/ec2/">Amazon EC2</a>, <a href="http://cloud.docker.com/">Docker Cloud</a>, or even use continuous integration services such as <a href="https://travis-ci.org/">Travis CI</a> or <a href="https://about.gitlab.com/gitlab-ci/">Gitlab CI</a>.
Or it could use a combination of these.</p>
<p>Not all of these options provide the flexibility to provide configurations outside of containers, for example specific operating system kernels.
An implementing system must manage these independently, for example by mapping ERC requirements like an operating system, to a part of the execution infrastructure that supports it.</p>
<h4 id="524-whitebox-data-repositories">5.2.4 Whitebox Data Repositories<a class="headerlink" href="#524-whitebox-data-repositories" title="Permanent link">&para;</a></h4>
<p><a href="img/5.2-whitebox-data-repos.png"><img alt="whitebox data repositories" src="img/5.2-whitebox-data-repos.png" /></a></p>
<p>The reproducibility service <em>does not persistently store anything</em>.
It only keeps copies of files during creation and inspection.
So where are ERCs saved and where is their data coming from?</p>
<p><strong>Collaboration platforms</strong>, e.g. <a href="http://sciebo.de/">ownCloud/Sciebo</a>, <a href="http://github.com/">GitHub</a>, <a href="http://sharelatex.com/">ShareLatex</a>, <a href="https://osf.io/">OSF</a>, allow users to create, store, and share their research (code, text, data, et cetera).
Besides being an interaction platform for users, they can also be seen simply as a data repository.
The reproducibility service fetches contents for building an ERC from them based on public links, e.g. a public GitHub repository or shared Sciebo folder.
It is possible to link ERC creation to an project/repository under development on a collaboration platform as to trigger an ERC (re-)creation or execution when changes are made.</p>
<p>Protocols: <code>WebDAV</code>, <code>ownCloud</code>, <code>HTTP</code> (including <a href="https://en.wikipedia.org/wiki/Webhook">webhooks</a>), <code>git</code></p>
<p><strong>Domain data repositories</strong>, e.g. <a href="https://www.pangaea.de/">PANGAEA</a> or <a href="http://dataservices.gfz-potsdam.de/portal/">GFZ Data Services</a>, can be accessed by the reproducibility service during creation and execution of ERC to download data.
Allowing access to data repositories reduces data duplication but requires control over/trust in the respective repository.</p>
<p>Protocol: <code>HTTP</code> APIs</p>
<p>Generic <strong>Repositories</strong>, e.g. <a href="https://zenodo.org/">Zenodo</a>, <a href="https://data.mendeley.com/">Mendeley Data</a>, <a href="http://figshare.com/">Figshare</a>, <a href="https://osf.io/">OSF</a>, provide (a) access to complete ERC stored in repositories for inspection and execution by the reproducibility service, and (b) storage of created ERC. repositories.</p>
<p>Protocols: (authenticated) <code>HTTP</code> APIs</p>
<p><strong>Archives</strong> and digital preservation solutions can provide long-term preservation of ERC.
The data repository and/or one of the involved platform providers are responsible for preservation.
A data repository might save the hosted content to an archive, be regularly harvested by an archive, or be part of a distributed dark archive, e.g. <a href="https://www.clockss.org">CLOCKSS</a>.
A platform provider might supply a digital preservation service, e.g. an installation of <a href="https://www.archivematica.org/">Archivematica</a>.</p>
<p>Protocol: <code>HTTP</code> carrying bitstreams and metadata</p>
<div class="admonition note">
<p class="admonition-title"><em>Data Curation Continuum</em></p>
<p>The Data Curation Continuum (cf. <a href="http://andrew.treloar.net/research/diagrams/data_curation_continuum.pdf">diagram by Andre Treloar</a>), describes how data moves from the private domain of a researcher to the public domain of data repositories over the course of conducting research. It describes the properties of data and important aspects of the transitions. In a publishing process based on the reproducibility service, the full migration process is run through. </p>
</div>
<h4 id="525-whitebox-registries">5.2.5 Whitebox Registries<a class="headerlink" href="#525-whitebox-registries" title="Permanent link">&para;</a></h4>
<p>Research data registries and websites, for example (<a href="https://www.uni-muenster.de/FB7_MultimediaSupport/CRIS_Infoseite/Forschungsdatenbank_Infoseite.html">CRIS</a>, <a href="https://www.datacite.org/">DataCite</a>, <a href="https://scholar.google.de/">Google Scholar</a>, <a href="https://www.scopus.com/">Scopus</a>, <a href="https://www.altmetric.com/">Altmetric</a>, to name just a few, collect metadata on publications and provide services with this data.
Services comprise discovery but also derivation of citation data and creating networks of researchers and publications.</p>
<p>The listed examples include open platforms, commercial solutions, and institution-specific platforms.
Some of the registries offer a public, well-defined API to retrieve structured metadata and to create new records.</p>
<p>Protocol: <code>HTTP</code> APIs</p>
<h4 id="526-whitebox-software-repositories">5.2.6 Whitebox Software Repositories<a class="headerlink" href="#526-whitebox-software-repositories" title="Permanent link">&para;</a></h4>
<p><a href="img/5.2-whitebox-software-repos.png"><img alt="whitebox software repositories" src="img/5.2-whitebox-software-repos.png" /></a></p>
<h5 id="5261-blackbox-package-repositories">5.2.6.1 Blackbox Package repositories<a class="headerlink" href="#5261-blackbox-package-repositories" title="Permanent link">&para;</a></h5>
<p>Package repositories are used during ERC creation to download and install software artifacts for specific operating systems, e.g. <a href="https://wiki.debian.org/Apt">Debian APT</a> or <a href="https://launchpad.net/ubuntu">Ubuntu Launchpad</a>, for specific programming languages or environments, e.g. <a href="https://cran.r-project.org/">CRAN</a>, or from source, e.g. <a href="https://github.com/">GitHub</a>.</p>
<h5 id="5262-blackbox-container-registries">5.2.6.2 Blackbox Container registries<a class="headerlink" href="#5262-blackbox-container-registries" title="Permanent link">&para;</a></h5>
<p>Container registries such as <a href="https://hub.docker.com/">Docker Hub</a>, <a href="https://quay.io/">Quay</a>, self-hosted <a href="https://github.com/docker/distribution">Docker Registry 2.0</a> or <a href="https://aws.amazon.com/de/ecr/">Amazon ERC</a>, store executable images of runtime environments.
They can be used to distribute the runtime environments across the execution infrastructure and provide an intermediate ephemeral storage for the reproducibility service.</p>
<h4 id="527-whitebox-reproducibility-service">5.2.7 Whitebox Reproducibility Service<a class="headerlink" href="#527-whitebox-reproducibility-service" title="Permanent link">&para;</a></h4>
<p><a href="img/5.2-whitebox-repro-service.png"><img alt="whitebox reproducibility service" src="img/5.2-whitebox-repro-service.png" /></a></p>
<h5 id="5271-blackbox-webserver">5.2.7.1 Blackbox Webserver<a class="headerlink" href="#5271-blackbox-webserver" title="Permanent link">&para;</a></h5>
<p>A webserver handles all incoming calls to the API (<code>/api/v1/</code>) via <code>HTTPS</code> (<code>HTTP</code> is redirected) and distributes them to the respective microservice.
A working <a href="https://nginx.org">nginx</a> configuration is available <a href="https://github.com/o2r-project/o2r-platform/blob/master/dev/nginx.conf">in the test setup</a>.</p>
<h5 id="5272-blackbox-ui">5.2.7.2 Blackbox UI<a class="headerlink" href="#5272-blackbox-ui" title="Permanent link">&para;</a></h5>
<p>The UI is a web application based on <a href="https://angularjs.org/">Angular JS</a>, see <a href="https://github.com/o2r-project/o2r-platform">o2r-platform</a>.
It connects to all microservices via their API and is served using the same webserver as the API.</p>
<h5 id="5273-blackbox-microservices">5.2.7.3 Blackbox Microservices<a class="headerlink" href="#5273-blackbox-microservices" title="Permanent link">&para;</a></h5>
<p>The reproducibility service uses a <a href="https://en.wikipedia.org/wiki/Microservices">microservice architecture</a> to separate functionality defined by the <strong><a href="https://o2r.info/api">web API specification</a></strong> into manageable units.</p>
<p>This allows scalability (selected microservices can be deployed as much as needed) and technology independence for each use case and developer.
The microservices all access one main database and a shared file storage.</p>
<h5 id="5274-blackbox-tools">5.2.7.4 Blackbox Tools<a class="headerlink" href="#5274-blackbox-tools" title="Permanent link">&para;</a></h5>
<p>Some functionality is developed as standalone tools and used as such in the microservices instead of re-implementing features.
These tools are integrated via their command line interface (CLI) and executed as <em>2nd level containers</em> by microservices.</p>
<h5 id="5275-blackbox-databases">5.2.7.5 Blackbox Databases<a class="headerlink" href="#5275-blackbox-databases" title="Permanent link">&para;</a></h5>
<p>The <em>main document database</em> is the unifying element of the microservice architecture.
All information shared between microservices or transactions between microservices are made via the database, including session state handling for authentication.</p>
<p>A <em>search database</em> is used for full-text search and advanced queries.</p>
<p>The database's operation log, normally used for synchronization between database nodes, is also used for </p>
<ul>
<li>event-driven communication between microservices, and</li>
<li>synchronization between main document database and search index.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This eventing "hack" is expected to be replaced by a proper eventing layer for productive deployments.</p>
</div>
<h5 id="5276-blackbox-ephemeral-file-storage">5.2.7.6 Blackbox Ephemeral file storage<a class="headerlink" href="#5276-blackbox-ephemeral-file-storage" title="Permanent link">&para;</a></h5>
<p>After loading from external sources and during creation of ERC, the files are stored in a file storage shared between the microservices.
The file structure is known to each microservice and read/write operations happen as needed.</p>
<h3 id="53-refinement-level-3">5.3 Refinement Level 3<a class="headerlink" href="#53-refinement-level-3" title="Permanent link">&para;</a></h3>
<h4 id="531-whitebox-microservices">5.3.1 Whitebox microservices<a class="headerlink" href="#531-whitebox-microservices" title="Permanent link">&para;</a></h4>
<p>Each microservice is encapsulated as a <a href="http://docker.com/">Docker</a> container running at its own port on an internal network and only serving its respective API path.
Internal communication between the webserver and the microservices is unencrypted, i.e. <code>HTTP</code>.</p>
<p><strong>Testing</strong>: the <a href="https://github.com/o2r-project/reference-implementation">reference implementation</a> provides instructions on running a local instance ofr the microservices and the demonstration UI.</p>
<p><strong>Development</strong>: the <a href="https://github.com/o2r-project/o2r-platform">o2r-platform</a> GitHub project contains <a href="https://docs.docker.com/compose/compose-file/">docker-compose</a> configurations to run all microservices, see repository file <code>docker-compose.yml</code> and the project's <code>README.md</code> for instructions.</p>
<p>The following table describes the microservices, their endpoints, and their features.</p>
<table>
<thead>
<tr>
<th><strong>Project</strong></th>
<th><strong>API path</strong></th>
<th><strong>Language</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/o2r-project/o2r-muncher">muncher</a></td>
<td><code>/api/v1/compendium</code> and <code>/api/v1/job</code></td>
<td>JavaScript (Node.js)</td>
<td>core component for <a href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a> of compendia and jobs (ERC execution)</td>
</tr>
<tr>
<td><a href="https://github.com/o2r-project/o2r-loader">loader</a></td>
<td><code>/api/v1/compendium</code> (<code>HTTP POST</code> only)</td>
<td>JavaScript (Node.js)</td>
<td>load workspaces from repositories and collaboration platforms</td>
</tr>
<tr>
<td><a href="https://github.com/o2r-project/o2r-finder">finder</a></td>
<td><code>/api/v1/search</code></td>
<td>JavaScript (Node.js)</td>
<td>discovery and search, synchronizes the database with a search database (Elasticsearch) and exposes read-only search endpoints</td>
</tr>
<tr>
<td><a href="https://github.com/o2r-project/o2r-transporter">transporter</a></td>
<td><code>~ /data/</code> and <code>~* \.(zip|tar|tar.gz)</code></td>
<td>JavaScript (Node.js)</td>
<td>downloads of compendia in zip or (gzipped) tar formats</td>
</tr>
<tr>
<td><a href="https://github.com/o2r-project/o2r-informer">informer</a></td>
<td><code>~* \.io</code></td>
<td>JavaScript (Node.js)</td>
<td><a href="http://socket.io/">socket.io</a>-based WebSockets for live updates to the UI based on database event log, e.g. job progress</td>
</tr>
<tr>
<td><a href="https://github.com/o2r-project/o2r-inspecter">inspecter</a></td>
<td><code>/api/v1/inspection</code></td>
<td>R (<a href="https://www.rplumber.io/">plumber</a>)</td>
<td>allow inspection of non-text-based file formats, e.g. <code>.Rdata</code></td>
</tr>
<tr>
<td><a href="https://github.com/o2r-project/o2r-substituter">substituter</a></td>
<td><code>/api/v1/substitution</code></td>
<td>JavaScript (Node.js)</td>
<td>create new ERCs based on existing ones by substituting files</td>
</tr>
<tr>
<td><a href="https://github.com/o2r-project/o2r-manipulater/">manipulater</a></td>
<td><code>under development</code></td>
<td>--</td>
<td>provide back-end containers for interactive ERCs</td>
</tr>
</tbody>
</table>
<h5 id="erc-exporting">ERC exporting<a class="headerlink" href="#erc-exporting" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th><strong>Project</strong></th>
<th><strong>API path</strong></th>
<th><strong>Language</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/o2r-project/o2r-shipper">shipper</a></td>
<td><code>/api/v1/shipment</code></td>
<td>Python</td>
<td>ship ERCs, including packaging, and their metadata to third party repositories and archives</td>
</tr>
</tbody>
</table>
<h5 id="authentication">Authentication<a class="headerlink" href="#authentication" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th><strong>Project</strong></th>
<th><strong>API path</strong></th>
<th><strong>Language</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/o2r-project/o2r-bouncer">bouncer</a></td>
<td><code>/api/v1/auth</code>, <code>/api/v1/user/</code></td>
<td>JavaScript (Node.js)</td>
<td>authentication service and user management (whoami, level changing)</td>
</tr>
</tbody>
</table>
<h5 id="supporting-services">Supporting services<a class="headerlink" href="#supporting-services" title="Permanent link">&para;</a></h5>
<p>Existing software projects can be re-used for common functionality, such as gathering statistics.
These supporting services run alongside the microservices in their own containers accessible via the main webservice.</p>
<table>
<thead>
<tr>
<th><strong>Project</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://matomo.org/">Piwik</a></td>
<td>collect user statistics</td>
</tr>
</tbody>
</table>
<h4 id="532-whitebox-database">5.3.2 Whitebox database<a class="headerlink" href="#532-whitebox-database" title="Permanent link">&para;</a></h4>
<p>Two databases are used.</p>
<p><strong><a href="https://www.mongodb.com/">MongoDB</a> document database</strong> with enabled <a href="https://docs.mongodb.com/manual/core/replica-set-oplog/">replica-set oplog</a> for eventing.</p>
<p>Collections:</p>
<ul>
<li><code>users</code></li>
<li><code>sessions</code></li>
<li><code>compendia</code></li>
<li><code>jobs</code></li>
<li><code>shipments</code></li>
</ul>
<p>The MongoDB API is used by connecting microservices via suitable client packages, which are available for all required languages.</p>
<p><strong><a href="https://elastic.co">Elasticsearch</a> search index</strong>, kept in sync with the main document database by the microservice <code>finder</code>.
The ids are mapped to support update and delete operations.</p>
<p>The two main resources of the API are kept in separate indices due to <a href="https://www.elastic.co/blog/index-vs-type">their different structure/mappings</a>:</p>
<ul>
<li><code>compendia</code> with type <code>compendia</code></li>
<li><code>jobs</code> with type <code>jobs</code></li>
</ul>
<p>The search index is accessed by clients through the search endpoint provided by <code>finder</code>.</p>
<h4 id="533-whitebox-tools">5.3.3 Whitebox tools<a class="headerlink" href="#533-whitebox-tools" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th><strong>project</strong></th>
<th><strong>language</strong></th>
<th><strong>description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/o2r-project/o2r-meta">meta</a></td>
<td>Python</td>
<td>scripts for extraction, translation and validation of metadata; for details see <a href="/metadata">metadata documentation</a></td>
</tr>
<tr>
<td><a href="https://github.com/o2r-project/containerit">containerit</a></td>
<td>R</td>
<td>generation of Dockerfiles based on R sessions and scripts</td>
</tr>
</tbody>
</table>
<p>Each tool's code repository includes one or more <code>Dockerfiles</code>, which are automatically build and published on Docker Hub.
The microservices use the tool's Docker images to execute the tools instead of installing all their dependencies into the microservices.
The advantages are a controlled environment for the tool usage, independent development cycles and updating of the tools, smaller independent images for the microservices, and scalability.</p>
<h4 id="meta">Meta<a class="headerlink" href="#meta" title="Permanent link">&para;</a></h4>
<p>Meta provides a CLI for each step of the metadata processing required in the reproducibility service as shown by the following diagram.
After each step the created metadata is saved as a file per model to a directory in the compendium.
A detailed view of the meta tool usage in the creation process is provided in the runtime view <a href="#61-erc-creation">ERC Creation</a>.</p>
<p><a href="img/5.2-whitebox-meta-tool.png"><img alt="whitebox meta tool" src="img/5.2-whitebox-meta-tool.png" /></a></p>
<h4 id="containerit">Containerit<a class="headerlink" href="#containerit" title="Permanent link">&para;</a></h4>
<p>The containerit tool extracts required dependencies from ERC main documents and uses the information and external configuration to create a Dockerfile, which executes the full computational workflow when the container is started.
Its main strategy is to analyse the session at the end of executing the full workflow.</p>
<h4 id="534-whitebox-ephemeral-file-storage">5.3.4 Whitebox ephemeral file storage<a class="headerlink" href="#534-whitebox-ephemeral-file-storage" title="Permanent link">&para;</a></h4>
<p>A host directory is mounted into every container to the location <code>/tmp/o2r</code>.</p>
<h2 id="6-runtime-view">6. Runtime view<a class="headerlink" href="#6-runtime-view" title="Permanent link">&para;</a></h2>
<p>The runtime view describes the interaction between the static building blocks.
It cannot cover all potential cases and focusses on the following main scenarios.</p>
<table>
<thead>
<tr>
<th><strong>Scenario</strong></th>
<th><strong>Purpose and overview</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ERC Creation</td>
<td>The most important workflow for an author is creating an ERC from his workspace of data, code and documentation. The author can provide these resources as a direct upload, but a more comfortable process is loading the files from a collaboration platform. Three microservices are core to this scenario: <code>loader</code>, <code>muncher</code>, and <code>shipper</code>.</td>
</tr>
<tr>
<td>ERC Inspection</td>
<td>The most important workflow for a reviewer or reader is executing the analysis encapsulated in an ERC. The execution comprises creation of configuration files (if missing) from metadata, compiling the a display file using the actual analysis, and saving the used runtime environment. The core microservice for this scenario is <code>muncher</code>.</td>
</tr>
</tbody>
</table>
<h3 id="61-erc-creation">6.1 ERC Creation<a class="headerlink" href="#61-erc-creation" title="Permanent link">&para;</a></h3>
<p><a href="img/6.1-runtime-view-creation.png"><img alt="runtime view ERC creation" src="img/6.1-runtime-view-creation.png" /></a></p>
<p>First, the user initiates a <em>creation</em> of a new ERC based on a workspace containing at least a viewable file (e.g. an HTML document or a plot) based on the code and instructions provided in a either a script or <a href="/glossary#literate-programming">literate programming document</a>), and any other data.
The <a href="#531-whitebox-microservices"><code>loader</code></a> runs a series of steps: fetching the files, checking the incoming workspace structure, extracting raw metadata from the workspace, brokering raw metadata to o2r metadata, and saving the compendium to the database.
The compendium is now a non-public <em>candidate</em>, meaning only the uploading user or admin users can see and edit it.
All metadata processing is based on the tool <a href="#533-whitebox-tools"><code>meta</code></a>.</p>
<p>Then the user opens the candidate compendium, reviews and completes the metadata, and saves it.
Saving triggers a metadata validation in <a href="#531-whitebox-microservices"><code>muncher</code></a>.
If the validation succeeds, the metadata is brokered to several output formats as files within the compendium using <a href="#533-whitebox-tools"><code>meta</code></a>, and then re-loaded to the database for better <a href="#532-whitebox-database">searchability</a>.</p>
<p>Next, the user must start a <em>job</em> to add the ERC configuration and runtime environment to the workspace, which are core elements of an ERC.
The ERC configuration is a file generated from the user-provided metadata (see <a href="https://o2r.info/erc-spec/spec/#erc-configuration-file">ERC specification</a>).
The runtime environment consists of two parts: (a) the runtime manifest, which is created by executing the workflow once in a container based on the tool <a href="#533-whitebox-tools"><code>containerit</code></a>; and (b) the runtime image, which is built from the runtime manifest.
A user may provide the ERC configuration file and the runtime manifest with the workspace for fine-grained control; the generation steps are skipped then.</p>
<p>Finally the user starts a shipment of the compendium to a data repository.
The <a href="#531-whitebox-microservices"><code>shipper</code></a> manages this two step process.
The separate "create" and "publish" steps allow checking the shipped files and avoid unintentional shipments, because a published shipment creates an non-erasable public resource.</p>
<div class="admonition note">
<p class="admonition-title"><em>In the code</em></p>
<p>The <code>loader</code> has two core controllers for direct <em>upload</em> and <em>load</em> from a collaboration platform.
Their core chain of functions are realised as <a href="/glossary#javascript-promises">JavaScript Promises</a>, see the code for <a href="https://github.com/o2r-project/o2r-loader/blob/master/lib/loader.js#L48">loader</a> and <a href="https://github.com/o2r-project/o2r-loader/blob/master/lib/uploader.js#L44">uploader</a> respectively.
The respective steps are shared between these two cases where possible, i.e. starting with the step <code>stripSingleBasedir</code>.</p>
</div>
<h3 id="62-erc-inspection">6.2 ERC Inspection<a class="headerlink" href="#62-erc-inspection" title="Permanent link">&para;</a></h3>
<p><a href="img/6.2-runtime-view-inspection.png"><img alt="runtime view ERC inspection" src="img/6.2-runtime-view-inspection.png" /></a></p>
<p>The user initiates an <em>inspection</em> of an existing ERC by providing a reference such as <a href="/glossary#doi">DOI</a> or URL.
<a href="#531-whitebox-microservices"><code>loader</code></a> retrieves the compendium files, saves them locally and loads the contained metadata.
Then the user can start a new <em>job</em> for the compendium.
<a href="#531-whitebox-microservices"><code>muncher</code></a> checks the request, creates a new job in the database and returns the job ID.
The user's client can use the ID to connect to the live logs provided by <a href="#531-whitebox-microservices"><code>informer</code></a>.
All following steps by muncher regularly update the database, whose change events <code>informer</code> uses to continuously update client via WebSockets.</p>
<p>The job starts with creating a copy of the compendium's files for the job.
A <a href="https://en.wikipedia.org/wiki/Copy-on-write">copy-on-write filesystem</a> is advantageous for this step.
Then the archived runtime image is loaded from the file in the compendium into a runtime repository.
This repository may be remote (either public or private, e.g. based on <a href="https://github.com/docker/distribution">Docker Registry</a>, <a href="https://aws.amazon.com/ecr/">ECR</a> or <a href="https://docs.gitlab.com/ce/user/project/container_registry.html">GitLab</a>) or simply the local image storage.
Then all files except the runtime image archive are packed so they can be send to a container runtime.
The container runtime can be local (e.g. the Docker daemon), or a container orchestration such as <a href="https://en.wikipedia.org/wiki/Kubernetes">Kubernetes</a>.
It provides log updates as a stream to <code>muncher</code>, which updates the database, whose changes trigger updates of the user interface via <code>informer</code>.
When the container is finished, <code>muncher</code> compares the created outputs with the ones provided in the compendium and provides the result to the user.</p>
<div class="admonition note">
<p class="admonition-title"><em>In the code</em></p>
<p>The <code>muncher</code> has two core resources: a <em>compendium</em> represents an ERC, a <em>job</em> represents a <em>"run"</em> of an ERC, i.e. the building, running, and saving of the runtime environment including execution of the contained workflow.
The core function for this is the <code>Executor</code>, which chains a number of steps using <a href="/glossary#javascript-promises">JavaScript Promises</a>, see the <a href="https://github.com/o2r-project/o2r-muncher/blob/master/lib/executor.js#L1306">code</a>.
The check uses the tool <a href="https://github.com/o2r-project/erc-checker"><code>erc-checker</code></a>.</p>
</div>
<h2 id="7-deployment-view">7. Deployment View<a class="headerlink" href="#7-deployment-view" title="Permanent link">&para;</a></h2>
<h3 id="71-test-server-httpso2runi-muensterde">7.1 Test server <a href="https://o2r.uni-muenster.de">https://o2r.uni-muenster.de</a><a class="headerlink" href="#71-test-server-httpso2runi-muensterde" title="Permanent link">&para;</a></h3>
<p><a href="img/7.1-deployment-view-testserver.png"><img alt="deployment view test server" src="img/7.1-deployment-view-testserver.png" /></a></p>
<dl>
<dt>Motivation</dt>
<dd>
<p>The o2r infrastructure is driven by the research community's need for user friendly and transparent but also scalable and reliable solutions to increase computational reproducibility in the scientific publication process. To retrieve feedback from the community (public demo) and to increase software quality (controlled non-development environment), the current development state is regularly published on a test server.</p>
</dd>
<dt>Quality and/or Performance Features</dt>
<dd>
<p>The server is managed completely with <a href="https://www.ansible.com/">Ansible</a> to ensure a well-document setup. The base operating system is CentOS Linux 7. The machine has 4 cores, 8 GB RAM, and a local storage ~100 GB, and runs on a VM host. The one machine in this deployment runs the full o2r reproducibility service, i.e. all microservices and a webserver to serve the user interfaces. It also runs the databases and ancillary services, such as a web traffic statistics service. When executing a compendium, the compendium workspace is packaged in a tarball and send to the Docker daemon. This allows easy switching to remote machines, but also has a performance disadvantage.</p>
</dd>
<dt>Mapping of Building Blocks to Infrastructure</dt>
<dd>
<p>All building blocks run in their own Docker container using an image provided via and build on <a href="https://hub.docker.com/r/o2rproject/">Docker Hub</a> using a <code>Dockerfile</code> included in <a href="https://github.com/search?q=topic%3Amicroservice+org%3Ao2r-project+fork%3Atrue">each microservice's code repository</a>. The server is managed by the o2r team; external building blocks are managed by the respective organisation/provider.</p>
</dd>
</dl>
<h3 id="72-production-sketch">7.2 Production (sketch)<a class="headerlink" href="#72-production-sketch" title="Permanent link">&para;</a></h3>
<p><a href="img/7.2-deployment-view-production-sketch.png"><img alt="deployment view test server" src="img/7.2-deployment-view-production-sketch.png" /></a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This deployment view is a sketch for a potential productive deployment and intends to point out features of the chosen architecture and expected challenges or solutions.
<em>It is not implemented at the moment!</em></p>
</div>
<dl>
<dt>Motivation</dt>
<dd>
<p>A productive system must be reliable and scalable providing a single reproducibility service API endpoint. It must also adopt the distribution and deployments of the reproducibility service's microservices. Being based on containers it naturally uses one of the powerful orchestration engines, such as <a href="https://docs.docker.com/engine/swarm">Docker Swarm</a> or <a href="http://kubernetes.io/">Kubernetes</a>. It can also include multiple execution infrastructures to support multiple container software versions, different architectures, kernels, GPUs, or even specialised hardware. Operators of a reproducibility service can separate themselves from other operators by offering specific hardware or versions.</p>
</dd>
<dt>Quality and/or Performance Features</dt>
<dd>
<p>The services are redundantly provided via separated clusters of nodes for (a) running the reproducibility service's microservices and ancillary services, (b) running the document and search databases, (c) running ERC executions. Separating the clusters allows common security protocols, e.g. the tool and execution cluster should not be able to contact arbitrary websites. The software in the data cluster can run in containers or bare metal. The clusters for app and compendia have access to a common shared file storage, a potential bottleneck. Performance of microservices can be easily scaled by adding nodes to the respective clusters. The diversity of supported ERCs can be increased by providing different architectures and kernels, and hardware. Some requirements could be met on demand using virtualisation, such as a specific operating system version.</p>
</dd>
<dt>Mapping of Building Blocks to Infrastructure</dt>
<dd>
<p>The o2r reproducibility service and execution infrastructures are managed by the o2r team similar to the test server. The other big building blocks, like publishing platforms or data repositories, are managed by the respective organisations.</p>
</dd>
</dl>
<hr />
<h2 id="credits">Credits<a class="headerlink" href="#credits" title="Permanent link">&para;</a></h2>
<p>This specification and guides are developed by the members of the project Opening Reproducible Research (<a href="https://www.uni-muenster.de/forschungaz/project/9520">Offene Reproduzierbare Forschung</a>) funded by the German Research Foundation (Deutsche Forschungsgemeinschaft (DFG) - Projektnummer <a href="http://gepris.dfg.de/gepris/projekt/274927273">274927273</a>) under grant numbers PE 1632/10-1, KR 3930/3-1, and TR 864/6-1).</p>
<blockquote>
<p><a href="https://o2r.info"><img alt="Opening Reproducible Research" src="img/o2r-logo.png" /></a></p>
<p><em>Opening Reproducible Research (o2r, <a href="https://o2r.info/about">https://o2r.info/about</a>) is a DFG-funded research project by Institute for Geoinformatics (<a href="http://www.uni-muenster.de/Geoinformatics/">ifgi</a>) and University and Regional Library (<a href="https://www.ulb.uni-muenster.de/">ULB</a>), University of Münster, Germany. Building on recent advances in mainstream IT, o2r envisions a new architecture for storing, executing and interacting with the original analysis environment alongside the corresponding research data and manuscript. This architecture evolves around so called Executable Research Compendia (ERC) as the container for both research, review, and archival.</em></p>
</blockquote>
<p>To cite this specification please use</p>
<blockquote>
<p><em>Nüst, Daniel, 2018. Reproducibility Service for Executable Research Compendia: Technical Specifications and Reference Implementation. Zenodo. doi:<a href="http://doi.org/10.5281/zenodo.2203844">10.5281/zenodo.2203844</a></em></p>
</blockquote>
<p>For a complete list of publications, posters, presentations, and software projects from th2 o2r project please visit <a href="https://o2r.info/results/">https://o2r.info/results/</a>.</p>
<hr />
<h2 id="license">License<a class="headerlink" href="#license" title="Permanent link">&para;</a></h2>
<p><img alt="CC-0 Button" src="https://licensebuttons.net/p/zero/1.0/88x31.png" /></p>
<p>The o2r architecture specification is licensed under <a href="https://creativecommons.org/publicdomain/zero/1.0/">Creative Commons CC0 1.0 Universal License</a>, see file <a href="https://raw.githubusercontent.com/o2r-project/architecture/arc42/LICENSE"><code>LICENSE</code></a>.
To the extent possible under law, the people who associated CC0 with this work have waived all copyright and related or neighboring rights to this work.
This work is published from: Germany.</p>
<hr />
<h2 id="about-arc42">About arc42<a class="headerlink" href="#about-arc42" title="Permanent link">&para;</a></h2>
<p>arc42, the Template for documentation of software and system architecture.</p>
<p>By Dr. Gernot Starke, Dr. Peter Hruschka and contributors.</p>
<p>Template Revision: 7.0 EN (based on asciidoc), January 2017</p>
<p>© We acknowledge that this document uses material from the arc 42 architecture template, <a href="http://www.arc42.de">http://www.arc42.de</a>. Created by Dr. Peter Hruschka &amp; Dr. Gernot Starke.</p>
<hr />
<div class="buildinfo">Build 0d60d5e @ 2021-07-01 11:54:09 +0200</div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="user-scenarios/" class="btn btn-neutral float-right" title="User scenarios">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Licensed under Creative Commons CC0 1.0 Universal License.</p>
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/o2r-project/architecture/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
    
      <span><a href="user-scenarios/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '.';</script>
    <script src="js/theme_extra.js" defer></script>
    <script src="js/theme.js" defer></script>
      <script src="search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>

<!--
MkDocs version : 1.2.1
Build Date UTC : 2021-07-01 09:54:54.156119+00:00
-->
