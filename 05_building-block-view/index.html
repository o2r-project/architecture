<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="o2r project">
  <link rel="canonical" href="https://o2r.info/architecture/05_building-block-view/">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>05 building block view - o2r Architecture</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  <link href="../arc42.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "05 building block view";
    var mkdocs_page_input_path = "05_building-block-view.md";
    var mkdocs_page_url = "/architecture/05_building-block-view/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> o2r Architecture</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Architecture</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../user-scenarios/">User scenarios</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../glossary/">Glossary</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../metadata/">Metadata</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../zenodo/">Zenodo integration</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">o2r Architecture</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>05 building block view</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/o2r-project/architecture/tree/master/docs/05_building-block-view.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h2 id="5-building-block-view">5. Building block view<a class="headerlink" href="#5-building-block-view" title="Permanent link">&para;</a></h2>
<h3 id="51-refinement-level-1">5.1 Refinement Level 1<a class="headerlink" href="#51-refinement-level-1" title="Permanent link">&para;</a></h3>
<h4 id="511-blackbox-publication-platforms">5.1.1 Blackbox Publication Platforms<a class="headerlink" href="#511-blackbox-publication-platforms" title="Permanent link">&para;</a></h4>
<p>Publications platforms are the online interaction points of users with scientific works.
Users create publications, e.g. submitting to a scientific journal, publishing on a pre-print server, publishing on a self-hosted website, or collaborating in online repositories.
Users examine publications, e.g. browsing, searching, reading, downloading, or reviewing.</p>
<h4 id="512-blackbox-id-provider">5.1.2 Blackbox ID Provider<a class="headerlink" href="#512-blackbox-id-provider" title="Permanent link">&para;</a></h4>
<p>Identification information of distributed systems is crucial, and for security reasons as well as for limiting manual reproduction of metadata, a central service can provide all of</p>
<ul>
<li>unique <em>identification of users</em> and <em>metadata on users</em>,</li>
<li><em>authentication</em> of users, and</li>
<li>metadata on a user's <em>works</em>, e.g. publications or ERC.</li>
</ul>
<p>Persistent identifiers for artifacts in the reproducibility service itself are <em>not required</em>, as these are provided by data storage and registries.
However, services such as <a href="http://www.pidconsortium.eu/">ePIC</a> could allow to retrieve persistent IDs.</p>
<h4 id="513-blackbox-execution-infrastructure">5.1.3 Blackbox Execution Infrastructure<a class="headerlink" href="#513-blackbox-execution-infrastructure" title="Permanent link">&para;</a></h4>
<p>The execution infrastructure provides CPU time and temporary result storage space for execution of ERC, both "as is" and with manipulation, i.e. changed parameters.
It also provides different <a href="/glossary#architecture">architectures</a> and <a href="/glossary#kernel">operating system kernel</a> configurations which are outside of the scope of ERC's runtime environments based on containers.</p>
<h4 id="514-blackbox-data-repositories">5.1.4 Blackbox Data Repositories<a class="headerlink" href="#514-blackbox-data-repositories" title="Permanent link">&para;</a></h4>
<p>Data repositories are all services storing data but not software.
More specifically, they may store software "as data", but not with software-specific features such as code versioning or installation binaries for different computer architectures.
Data repositories may be self-hosted or public/free, domain-specific or generic.
They typically provide persistent identifiers or handles, e.g. a <a href="https://www.doi.org/">DOI</a> or <a href="https://en.wikipedia.org/wiki/Uniform_Resource_Name">URN</a>.
They are used both for loading created ERC and for storing the ERC created by the reproducibility service.</p>
<h4 id="515-blackbox-registries">5.1.5 Blackbox Registries<a class="headerlink" href="#515-blackbox-registries" title="Permanent link">&para;</a></h4>
<p>Registries are metadata indexes or catalogues.</p>
<p>They are recipients of metadata exports by the reproducibility service to share information about ERC, e.g. add a new ERC to an author's profile.
This requires the reproducibility services to translate the internal metadata model into the recipients data model and encoding. </p>
<p>They are sources of metadata during ERC creation when the information in the fetched content is used to query registries for additional information which can be offered to the user.</p>
<h4 id="516-blackbox-software-repositories">5.1.6 Blackbox Software Repositories<a class="headerlink" href="#516-blackbox-software-repositories" title="Permanent link">&para;</a></h4>
<p>Software repositories are a source and a sink for software at different abstraction levels.
They are a source for software dependencies, such as system packages for installing a library.
They are a sink for executable images, which comprise a number of software artifacts and their dependencies, for a specific ERC instance.</p>
<h3 id="52-refinement-level-2">5.2 Refinement Level 2<a class="headerlink" href="#52-refinement-level-2" title="Permanent link">&para;</a></h3>
<h4 id="521-whitebox-publication-platforms">5.2.1 Whitebox Publication Platforms<a class="headerlink" href="#521-whitebox-publication-platforms" title="Permanent link">&para;</a></h4>
<p>Publication platforms can be roughly divided into two groups.
They can be either specific journals hosted independently, such as <a href="http://www.jstatsoft.org/">JStatSoft</a> or <a href="http://joss.theoj.org/">JOSS</a>, or a larger platform provided by a publisher to multiple journals, such as <a href="http://sciencedirect.com/">ScienceDirect</a>, <a href="http://www.mdpi.com/">MDPI</a>, <a href="https://link.springer.com/">SpringerLink</a>, or <a href="https://plos.org/">PLOS</a>.
To some extend, pre-print servers, for example <a href="https://osf.io/">OSF</a> or <a href="https://arxiv.org/">arXiv.org</a>, can also fall into the latter category.</p>
<p>Integration with the reproducibility service can happen via plug-ins to generic software, e.g. <a href="https://pkp.sfu.ca/ojs/">OJS</a>, or by bespoke extensions.
Integrations are based on the service's public API.</p>
<h4 id="522-whitebox-id-provider">5.2.2 Whitebox ID Provider<a class="headerlink" href="#522-whitebox-id-provider" title="Permanent link">&para;</a></h4>
<p>The reproducibility service uses <a href="http://orcid.org/">ORCID</a> to authenticate users and retrieve user metadata.
The reproducibility service does not use the ORCID authorisation to edit ORCID user data or retrieve non-public data from ORCID, thus this process is <a href="https://security.stackexchange.com/questions/44611/difference-between-oauth-openid-and-openid-connect-in-very-simple-term">pseudo-authentication using OAuth</a>.
Internally, the user's public <code>ORCID</code> is the main identifier.
User have different levels, which allow different actions, such as "registered user" or "administrator".
These levels are stored in the reproducibility service.</p>
<h4 id="523-whitebox-execution-infrastructure">5.2.3 Whitebox Execution Infrastructure<a class="headerlink" href="#523-whitebox-execution-infrastructure" title="Permanent link">&para;</a></h4>
<p>Such an infrastructure could be either self-hosted, e.g. <a href="https://www.docker.com/products/docker-swarm">Docker Swarm</a>-based, use a cloud service provider, such as <a href="https://aws.amazon.com/ec2/">Amazon EC2</a>, <a href="http://cloud.docker.com/">Docker Cloud</a>, or even use continuous integration services such as <a href="https://travis-ci.org/">Travis CI</a> or <a href="https://about.gitlab.com/gitlab-ci/">Gitlab CI</a>.
Or it could use a combination of these.</p>
<p>Not all of these options provide the flexibility to provide configurations outside of containers, for example specific operating system kernels.
An implementing system must manage these independently, for example by mapping ERC requirements like an operating system, to a part of the execution infrastructure that supports it.</p>
<h4 id="524-whitebox-data-repositories">5.2.4 Whitebox Data Repositories<a class="headerlink" href="#524-whitebox-data-repositories" title="Permanent link">&para;</a></h4>
<p><a href="../img/5.2-whitebox-data-repos.png"><img alt="whitebox data repositories" src="../img/5.2-whitebox-data-repos.png" /></a></p>
<p>The reproducibility service <em>does not persistently store anything</em>.
It only keeps copies of files during creation and inspection.
So where are ERCs saved and where is their data coming from?</p>
<p><strong>Collaboration platforms</strong>, e.g. <a href="http://sciebo.de/">ownCloud/Sciebo</a>, <a href="http://github.com/">GitHub</a>, <a href="http://sharelatex.com/">ShareLatex</a>, <a href="https://osf.io/">OSF</a>, allow users to create, store, and share their research (code, text, data, et cetera).
Besides being an interaction platform for users, they can also be seen simply as a data repository.
The reproducibility service fetches contents for building an ERC from them based on public links, e.g. a public GitHub repository or shared Sciebo folder.
It is possible to link ERC creation to an project/repository under development on a collaboration platform as to trigger an ERC (re-)creation or execution when changes are made.</p>
<p>Protocols: <code>WebDAV</code>, <code>ownCloud</code>, <code>HTTP</code> (including <a href="https://en.wikipedia.org/wiki/Webhook">webhooks</a>), <code>git</code></p>
<p><strong>Domain data repositories</strong>, e.g. <a href="https://www.pangaea.de/">PANGAEA</a> or <a href="http://dataservices.gfz-potsdam.de/portal/">GFZ Data Services</a>, can be accessed by the reproducibility service during creation and execution of ERC to download data.
Allowing access to data repositories reduces data duplication but requires control over/trust in the respective repository.</p>
<p>Protocol: <code>HTTP</code> APIs</p>
<p>Generic <strong>Repositories</strong>, e.g. <a href="https://zenodo.org/">Zenodo</a>, <a href="https://data.mendeley.com/">Mendeley Data</a>, <a href="http://figshare.com/">Figshare</a>, <a href="https://osf.io/">OSF</a>, provide (a) access to complete ERC stored in repositories for inspection and execution by the reproducibility service, and (b) storage of created ERC. repositories.</p>
<p>Protocols: (authenticated) <code>HTTP</code> APIs</p>
<p><strong>Archives</strong> and digital preservation solutions can provide long-term preservation of ERC.
The data repository and/or one of the involved platform providers are responsible for preservation.
A data repository might save the hosted content to an archive, be regularly harvested by an archive, or be part of a distributed dark archive, e.g. <a href="https://www.clockss.org">CLOCKSS</a>.
A platform provider might supply a digital preservation service, e.g. an installation of <a href="https://www.archivematica.org/">Archivematica</a>.</p>
<p>Protocol: <code>HTTP</code> carrying bitstreams and metadata</p>
<div class="admonition note">
<p class="admonition-title"><em>Data Curation Continuum</em></p>
<p>The Data Curation Continuum (cf. <a href="http://andrew.treloar.net/research/diagrams/data_curation_continuum.pdf">diagram by Andre Treloar</a>), describes how data moves from the private domain of a researcher to the public domain of data repositories over the course of conducting research. It describes the properties of data and important aspects of the transitions. In a publishing process based on the reproducibility service, the full migration process is run through. </p>
</div>
<h4 id="525-whitebox-registries">5.2.5 Whitebox Registries<a class="headerlink" href="#525-whitebox-registries" title="Permanent link">&para;</a></h4>
<p>Research data registries and websites, for example (<a href="https://www.uni-muenster.de/FB7_MultimediaSupport/CRIS_Infoseite/Forschungsdatenbank_Infoseite.html">CRIS</a>, <a href="https://www.datacite.org/">DataCite</a>, <a href="https://scholar.google.de/">Google Scholar</a>, <a href="https://www.scopus.com/">Scopus</a>, <a href="https://www.altmetric.com/">Altmetric</a>, to name just a few, collect metadata on publications and provide services with this data.
Services comprise discovery but also derivation of citation data and creating networks of researchers and publications.</p>
<p>The listed examples include open platforms, commercial solutions, and institution-specific platforms.
Some of the registries offer a public, well-defined API to retrieve structured metadata and to create new records.</p>
<p>Protocol: <code>HTTP</code> APIs</p>
<h4 id="526-whitebox-software-repositories">5.2.6 Whitebox Software Repositories<a class="headerlink" href="#526-whitebox-software-repositories" title="Permanent link">&para;</a></h4>
<p><a href="../img/5.2-whitebox-software-repos.png"><img alt="whitebox software repositories" src="../img/5.2-whitebox-software-repos.png" /></a></p>
<h5 id="5261-blackbox-package-repositories">5.2.6.1 Blackbox Package repositories<a class="headerlink" href="#5261-blackbox-package-repositories" title="Permanent link">&para;</a></h5>
<p>Package repositories are used during ERC creation to download and install software artifacts for specific operating systems, e.g. <a href="https://wiki.debian.org/Apt">Debian APT</a> or <a href="https://launchpad.net/ubuntu">Ubuntu Launchpad</a>, for specific programming languages or environments, e.g. <a href="https://cran.r-project.org/">CRAN</a>, or from source, e.g. <a href="https://github.com/">GitHub</a>.</p>
<h5 id="5262-blackbox-container-registries">5.2.6.2 Blackbox Container registries<a class="headerlink" href="#5262-blackbox-container-registries" title="Permanent link">&para;</a></h5>
<p>Container registries such as <a href="https://hub.docker.com/">Docker Hub</a>, <a href="https://quay.io/">Quay</a>, self-hosted <a href="https://github.com/docker/distribution">Docker Registry 2.0</a> or <a href="https://aws.amazon.com/de/ecr/">Amazon ERC</a>, store executable images of runtime environments.
They can be used to distribute the runtime environments across the execution infrastructure and provide an intermediate ephemeral storage for the reproducibility service.</p>
<h4 id="527-whitebox-reproducibility-service">5.2.7 Whitebox Reproducibility Service<a class="headerlink" href="#527-whitebox-reproducibility-service" title="Permanent link">&para;</a></h4>
<p><a href="../img/5.2-whitebox-repro-service.png"><img alt="whitebox reproducibility service" src="../img/5.2-whitebox-repro-service.png" /></a></p>
<h5 id="5271-blackbox-webserver">5.2.7.1 Blackbox Webserver<a class="headerlink" href="#5271-blackbox-webserver" title="Permanent link">&para;</a></h5>
<p>A webserver handles all incoming calls to the API (<code>/api/v1/</code>) via <code>HTTPS</code> (<code>HTTP</code> is redirected) and distributes them to the respective microservice.
A working <a href="https://nginx.org">nginx</a> configuration is available <a href="https://github.com/o2r-project/o2r-platform/blob/master/dev/nginx.conf">in the test setup</a>.</p>
<h5 id="5272-blackbox-ui">5.2.7.2 Blackbox UI<a class="headerlink" href="#5272-blackbox-ui" title="Permanent link">&para;</a></h5>
<p>The UI is a web application based on <a href="https://angularjs.org/">Angular JS</a>, see <a href="https://github.com/o2r-project/o2r-platform">o2r-platform</a>.
It connects to all microservices via their API and is served using the same webserver as the API.</p>
<h5 id="5273-blackbox-microservices">5.2.7.3 Blackbox Microservices<a class="headerlink" href="#5273-blackbox-microservices" title="Permanent link">&para;</a></h5>
<p>The reproducibility service uses a <a href="https://en.wikipedia.org/wiki/Microservices">microservice architecture</a> to separate functionality defined by the <strong><a href="https://o2r.info/api">web API specification</a></strong> into manageable units.</p>
<p>This allows scalability (selected microservices can be deployed as much as needed) and technology independence for each use case and developer.
The microservices all access one main database and a shared file storage.</p>
<h5 id="5274-blackbox-tools">5.2.7.4 Blackbox Tools<a class="headerlink" href="#5274-blackbox-tools" title="Permanent link">&para;</a></h5>
<p>Some functionality is developed as standalone tools and used as such in the microservices instead of re-implementing features.
These tools are integrated via their command line interface (CLI) and executed as <em>2nd level containers</em> by microservices.</p>
<h5 id="5275-blackbox-databases">5.2.7.5 Blackbox Databases<a class="headerlink" href="#5275-blackbox-databases" title="Permanent link">&para;</a></h5>
<p>The <em>main document database</em> is the unifying element of the microservice architecture.
All information shared between microservices or transactions between microservices are made via the database, including session state handling for authentication.</p>
<p>A <em>search database</em> is used for full-text search and advanced queries.</p>
<p>The database's operation log, normally used for synchronization between database nodes, is also used for </p>
<ul>
<li>event-driven communication between microservices, and</li>
<li>synchronization between main document database and search index.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This eventing "hack" is expected to be replaced by a proper eventing layer for productive deployments.</p>
</div>
<h5 id="5276-blackbox-ephemeral-file-storage">5.2.7.6 Blackbox Ephemeral file storage<a class="headerlink" href="#5276-blackbox-ephemeral-file-storage" title="Permanent link">&para;</a></h5>
<p>After loading from external sources and during creation of ERC, the files are stored in a file storage shared between the microservices.
The file structure is known to each microservice and read/write operations happen as needed.</p>
<h3 id="53-refinement-level-3">5.3 Refinement Level 3<a class="headerlink" href="#53-refinement-level-3" title="Permanent link">&para;</a></h3>
<h4 id="531-whitebox-microservices">5.3.1 Whitebox microservices<a class="headerlink" href="#531-whitebox-microservices" title="Permanent link">&para;</a></h4>
<p>Each microservice is encapsulated as a <a href="http://docker.com/">Docker</a> container running at its own port on an internal network and only serving its respective API path.
Internal communication between the webserver and the microservices is unencrypted, i.e. <code>HTTP</code>.</p>
<p><strong>Testing</strong>: the <a href="https://github.com/o2r-project/reference-implementation">reference implementation</a> provides instructions on running a local instance ofr the microservices and the demonstration UI.</p>
<p><strong>Development</strong>: the <a href="https://github.com/o2r-project/o2r-platform">o2r-platform</a> GitHub project contains <a href="https://docs.docker.com/compose/compose-file/">docker-compose</a> configurations to run all microservices, see repository file <code>docker-compose.yml</code> and the project's <code>README.md</code> for instructions.</p>
<p>The following table describes the microservices, their endpoints, and their features.</p>
<table>
<thead>
<tr>
<th><strong>Project</strong></th>
<th><strong>API path</strong></th>
<th><strong>Language</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/o2r-project/o2r-muncher">muncher</a></td>
<td><code>/api/v1/compendium</code> and <code>/api/v1/job</code></td>
<td>JavaScript (Node.js)</td>
<td>core component for <a href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a> of compendia and jobs (ERC execution)</td>
</tr>
<tr>
<td><a href="https://github.com/o2r-project/o2r-loader">loader</a></td>
<td><code>/api/v1/compendium</code> (<code>HTTP POST</code> only)</td>
<td>JavaScript (Node.js)</td>
<td>load workspaces from repositories and collaboration platforms</td>
</tr>
<tr>
<td><a href="https://github.com/o2r-project/o2r-finder">finder</a></td>
<td><code>/api/v1/search</code></td>
<td>JavaScript (Node.js)</td>
<td>discovery and search, synchronizes the database with a search database (Elasticsearch) and exposes read-only search endpoints</td>
</tr>
<tr>
<td><a href="https://github.com/o2r-project/o2r-transporter">transporter</a></td>
<td><code>~ /data/</code> and <code>~* \.(zip|tar|tar.gz)</code></td>
<td>JavaScript (Node.js)</td>
<td>downloads of compendia in zip or (gzipped) tar formats</td>
</tr>
<tr>
<td><a href="https://github.com/o2r-project/o2r-informer">informer</a></td>
<td><code>~* \.io</code></td>
<td>JavaScript (Node.js)</td>
<td><a href="http://socket.io/">socket.io</a>-based WebSockets for live updates to the UI based on database event log, e.g. job progress</td>
</tr>
<tr>
<td><a href="https://github.com/o2r-project/o2r-inspecter">inspecter</a></td>
<td><code>/api/v1/inspection</code></td>
<td>R (<a href="https://www.rplumber.io/">plumber</a>)</td>
<td>allow inspection of non-text-based file formats, e.g. <code>.Rdata</code></td>
</tr>
<tr>
<td><a href="https://github.com/o2r-project/o2r-substituter">substituter</a></td>
<td><code>/api/v1/substitution</code></td>
<td>JavaScript (Node.js)</td>
<td>create new ERCs based on existing ones by substituting files</td>
</tr>
<tr>
<td><a href="https://github.com/o2r-project/o2r-manipulater/">manipulater</a></td>
<td><code>under development</code></td>
<td>--</td>
<td>provide back-end containers for interactive ERCs</td>
</tr>
</tbody>
</table>
<h5 id="erc-exporting">ERC exporting<a class="headerlink" href="#erc-exporting" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th><strong>Project</strong></th>
<th><strong>API path</strong></th>
<th><strong>Language</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/o2r-project/o2r-shipper">shipper</a></td>
<td><code>/api/v1/shipment</code></td>
<td>Python</td>
<td>ship ERCs, including packaging, and their metadata to third party repositories and archives</td>
</tr>
</tbody>
</table>
<h5 id="authentication">Authentication<a class="headerlink" href="#authentication" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th><strong>Project</strong></th>
<th><strong>API path</strong></th>
<th><strong>Language</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/o2r-project/o2r-bouncer">bouncer</a></td>
<td><code>/api/v1/auth</code>, <code>/api/v1/user/</code></td>
<td>JavaScript (Node.js)</td>
<td>authentication service and user management (whoami, level changing)</td>
</tr>
</tbody>
</table>
<h5 id="supporting-services">Supporting services<a class="headerlink" href="#supporting-services" title="Permanent link">&para;</a></h5>
<p>Existing software projects can be re-used for common functionality, such as gathering statistics.
These supporting services run alongside the microservices in their own containers accessible via the main webservice.</p>
<table>
<thead>
<tr>
<th><strong>Project</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://matomo.org/">Piwik</a></td>
<td>collect user statistics</td>
</tr>
</tbody>
</table>
<h4 id="532-whitebox-database">5.3.2 Whitebox database<a class="headerlink" href="#532-whitebox-database" title="Permanent link">&para;</a></h4>
<p>Two databases are used.</p>
<p><strong><a href="https://www.mongodb.com/">MongoDB</a> document database</strong> with enabled <a href="https://docs.mongodb.com/manual/core/replica-set-oplog/">replica-set oplog</a> for eventing.</p>
<p>Collections:</p>
<ul>
<li><code>users</code></li>
<li><code>sessions</code></li>
<li><code>compendia</code></li>
<li><code>jobs</code></li>
<li><code>shipments</code></li>
</ul>
<p>The MongoDB API is used by connecting microservices via suitable client packages, which are available for all required languages.</p>
<p><strong><a href="https://elastic.co">Elasticsearch</a> search index</strong>, kept in sync with the main document database by the microservice <code>finder</code>.
The ids are mapped to support update and delete operations.</p>
<p>The two main resources of the API are kept in separate indices due to <a href="https://www.elastic.co/blog/index-vs-type">their different structure/mappings</a>:</p>
<ul>
<li><code>compendia</code> with type <code>compendia</code></li>
<li><code>jobs</code> with type <code>jobs</code></li>
</ul>
<p>The search index is accessed by clients through the search endpoint provided by <code>finder</code>.</p>
<h4 id="533-whitebox-tools">5.3.3 Whitebox tools<a class="headerlink" href="#533-whitebox-tools" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th><strong>project</strong></th>
<th><strong>language</strong></th>
<th><strong>description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/o2r-project/o2r-meta">meta</a></td>
<td>Python</td>
<td>scripts for extraction, translation and validation of metadata; for details see <a href="/metadata">metadata documentation</a></td>
</tr>
<tr>
<td><a href="https://github.com/o2r-project/containerit">containerit</a></td>
<td>R</td>
<td>generation of Dockerfiles based on R sessions and scripts</td>
</tr>
</tbody>
</table>
<p>Each tool's code repository includes one or more <code>Dockerfiles</code>, which are automatically build and published on Docker Hub.
The microservices use the tool's Docker images to execute the tools instead of installing all their dependencies into the microservices.
The advantages are a controlled environment for the tool usage, independent development cycles and updating of the tools, smaller independent images for the microservices, and scalability.</p>
<h4 id="meta">Meta<a class="headerlink" href="#meta" title="Permanent link">&para;</a></h4>
<p>Meta provides a CLI for each step of the metadata processing required in the reproducibility service as shown by the following diagram.
After each step the created metadata is saved as a file per model to a directory in the compendium.
A detailed view of the meta tool usage in the creation process is provided in the runtime view <a href="#61-erc-creation">ERC Creation</a>.</p>
<p><a href="../img/5.2-whitebox-meta-tool.png"><img alt="whitebox meta tool" src="../img/5.2-whitebox-meta-tool.png" /></a></p>
<h4 id="containerit">Containerit<a class="headerlink" href="#containerit" title="Permanent link">&para;</a></h4>
<p>The containerit tool extracts required dependencies from ERC main documents and uses the information and external configuration to create a Dockerfile, which executes the full computational workflow when the container is started.
Its main strategy is to analyse the session at the end of executing the full workflow.</p>
<h4 id="534-whitebox-ephemeral-file-storage">5.3.4 Whitebox ephemeral file storage<a class="headerlink" href="#534-whitebox-ephemeral-file-storage" title="Permanent link">&para;</a></h4>
<p>A host directory is mounted into every container to the location <code>/tmp/o2r</code>.</p>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Licensed under Creative Commons CC0 1.0 Universal License.</p>
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/o2r-project/architecture/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
